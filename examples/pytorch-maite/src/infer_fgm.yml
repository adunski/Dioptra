types:
  callback:
  dataset:
  directoryiterator:
  functiontype:
  kerasclassifier:
  metric:
  mlflowrun:
  tuple:
  model:
  modelversion:
  np.ndarray:
  optimizer:
  path:
  dataframe:
  rngenerator:
  sequential:
  tarfile:
  list_tuple_string_any:
    list: tuple_string_any
  list_union_metric_functiontype:
    list: union_metric_functiontype
  list_union_string_path:
    list: union_string_path
  list_mapping_string_string:
    list: mapping_string_string
  mapping_string_any:
    mapping: [string, any]
  mapping_string_number:
    mapping: [string, number]
  mapping_string_string:
    mapping: [string, string]
  tuple_integer_integer:
    tuple: [integer, integer]
  tuple_integer_integer_integer:
    tuple: [integer, integer, integer]
  tuple_string_any:
    tuple: [string, any]
  union_integer_number_string:
    union: [integer, number, string]
  union_integer_any:
    union: [integer, any]
  union_metric_functiontype:
    union: [metric, functiontype]
  union_null_list_tuple_string_any:
    union: [list_tuple_string_any , "null"]
  union_null_mapping_string_any:
    union: [mapping_string_any, "null"]
  union_null_modelversion:
    union: [modelversion, "null"]
  union_null_number:
    union: [number, "null"]
  union_null_string:
    union: [string, "null"]
  union_null_union_integer_any:
    union: [union_integer_any, "null"]
  union_string_path:
    union: [string, path]
  union_null_union_string_path:
    union: [union_string_path, "null"]
parameters:
  run_id: ""
  adv_tar_name: fgm.tar.gz
  adv_data_dir: adv_testing
  image_size: [3,224,224]
  new_size: 224
  model_provider_name: huggingface
  model_name: aaraki/vit-base-patch16-224-in21k-finetuned-cifar10
  model_task: image-classification
  metric_provider_name: torchmetrics
  metric_name: Accuracy
  metric_task: multiclass
  classes: 10
  batch_size: 32
  shape: [224,224]
  subset: 0
tasks:
  create_image_dataset:
    plugin: dioptra_custom.maite.maite_compat.create_image_dataset
    inputs:
      - data_dir: string
      - image_size: tuple_integer_integer_integer
      - name: new_size
        type: integer
        required: false
      - name: validation_split
        type: union_null_number
        required: false
      - name: batch_size
        type: integer
        required: false
      - name: label_mode
        type: string
        required: false
    outputs:
      - dataset_a: dataset
      - dataset_b: dataset
  get_model:
    plugin: dioptra_custom.maite.maite_compat.get_model
    inputs:
      - provider_name: string
      - model_name: string
      - task: string
    outputs:
      model: model
  get_metric:
    plugin: dioptra_custom.maite.maite_compat.get_metric
    inputs:
      - provider_name: string
      - metric_name: string
      - task: string
      - classes: integer
    outputs:
      metric: metric
  transform_tensor:
    plugin: dioptra_custom.maite.maite_compat.transform_tensor
    inputs:
      - dataset: dataset
      - shape: any
      - name: totensor
        type: boolean
        required: false
      - name: subset
        type: integer
        required: false
    outputs:
      dataset: dataset
  compute_metric:
    plugin: dioptra_custom.maite.maite_compat.compute_metric
    inputs:
      - dataset: dataset
      - model: model
      - metric: metric
      - task: string
      - batch_size: integer
    outputs:
      computed: mapping_string_number
  download_artifacts:
    plugin: dioptra_builtins.artifacts.mlflow.download_all_artifacts_in_run
    inputs:
      - run_id: string
      - artifact_path: string
      - name: destination_path
        type: union_null_string
        required: false
    outputs:
      download_path: string
  extract_tarfile:
    plugin: dioptra_builtins.artifacts.utils.extract_tarfile
    inputs:
      - filepath: union_string_path
      - name: tarball_read_mode
        type: string
        required: false
      - name: output_dir
        type: any
        required: false
graph:
  adv_tar_path:
    download_artifacts:
      run_id: $run_id
      artifact_path: $adv_tar_name
  extract_tarfile_results:
    extract_tarfile:
      filepath: $adv_tar_path
    dependencies: [adv_tar_path]
  dataset:
    create_image_dataset: 
      data_dir: $adv_data_dir
      validation_split: null
      batch_size: $batch_size
      image_size: $image_size
      new_size: $new_size
    dependencies: [extract_tarfile_results]
  model:
    get_model: 
      provider_name: $model_provider_name
      model_name: $model_name
      task: $model_task
  metric:
    get_metric: 
      provider_name: $metric_provider_name
      metric_name: $metric_name
      task: $metric_task
      classes: $classes
  transformed_dataset:
    transform_tensor: 
      dataset: $dataset.dataset_a
      shape: $shape
      subset: $subset
    dependencies: [dataset]
  metric_results:
    compute_metric:
      dataset: $transformed_dataset.dataset
      model: $model
      metric: $metric
      task: $model_task
      batch_size: $batch_size
    dependencies: [transformed_dataset, model, metric]
